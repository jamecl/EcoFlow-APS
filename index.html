<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoFlow ROI Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Calculator = () => {
            const [price, setPrice] = useState(4400);
            const [showCustom, setShowCustom] = useState(false);
            const [taxCredit, setTaxCredit] = useState(30);
            const [capacity, setCapacity] = useState(6.1);
            const [output, setOutput] = useState(7.2);
            const [batteries, setBatteries] = useState(1);
            const [offPeak, setOffPeak] = useState(5.943);
            const [onPeak, setOnPeak] = useState(14.227);
            const [demand, setDemand] = useState(19.585);
            const [tax, setTax] = useState(8.1);
            const [currentPeak, setCurrentPeak] = useState(5.0);
            const [unrestrictedPeak, setUnrestrictedPeak] = useState(10.3);
            const [acSeason, setAcSeason] = useState(6);
            const [acHours, setAcHours] = useState(1.5);
            const [realistic, setRealistic] = useState(true);
            const [smartPanel, setSmartPanel] = useState(false);
            const [panelCost, setPanelCost] = useState(4000);
            const [efficiency, setEfficiency] = useState(95);
            const [solar, setSolar] = useState(false);
            const [solarPanels, setSolarPanels] = useState(2);
            const [results, setResults] = useState({});
            
            useEffect(() => {
                if (!showCustom) {
                    if (price === 4400) { setBatteries(1); setCapacity(6.1); setOutput(7.2); }
                    else if (price === 6699) { setBatteries(2); setCapacity(12.2); setOutput(14.4); }
                    else if (price === 8999) { setBatteries(3); setCapacity(18.3); setOutput(21.6); }
                    else if (price === 11299) { setBatteries(4); setCapacity(24.4); setOutput(28.8); }
                }
            }, [price, showCustom]);
            
            useEffect(() => { calculate(); }, [price, taxCredit, capacity, output, batteries, offPeak, onPeak, demand, tax, currentPeak, unrestrictedPeak, acSeason, acHours, realistic, smartPanel, panelCost, efficiency, solar, solarPanels]);
            
            const calculate = () => {
                const systemCost = price * (1 - taxCredit / 100);
                const smartCost = smartPanel ? panelCost * (1 - taxCredit / 100) : 0;
                const solarCost = solar ? solarPanels * 150 * (1 - taxCredit / 100) : 0;
                const totalCost = systemCost + smartCost + solarCost;
                
                let actualBatteries, actualCapacity, actualOutput;
                if (price === 4400) { actualBatteries = 1; actualCapacity = 6.1; actualOutput = 7.2; }
                else if (price === 6699) { actualBatteries = 2; actualCapacity = 12.2; actualOutput = 14.4; }
                else if (price === 8999) { actualBatteries = 3; actualCapacity = 18.3; actualOutput = 21.6; }
                else if (price === 11299) { actualBatteries = 4; actualCapacity = 24.4; actualOutput = 28.8; }
                else { actualBatteries = batteries; actualCapacity = capacity; actualOutput = output; }
                
                let demandSavings, arbitrageSavings;
                if (realistic) {
                    const acDemandReduction = Math.min(actualOutput, unrestrictedPeak);
                    const acDemandSavings = acDemandReduction * demand * acSeason;
                    const offDemandReduction = Math.min(actualOutput, currentPeak);
                    const offDemandSavings = offDemandReduction * demand * (12 - acSeason);
                    demandSavings = acDemandSavings + offDemandSavings;
                    
                    const acEnergy = unrestrictedPeak * acHours * acSeason * 30;
                    const acArbitrage = acEnergy * ((onPeak - offPeak) / 100);
                    const currentArbitrage = 1614 * ((onPeak - offPeak) / 100);
                    arbitrageSavings = acArbitrage + currentArbitrage;
                } else {
                    demandSavings = actualOutput * demand * 12;
                    arbitrageSavings = 1000;
                }
                
                const solarSavings = solar ? solarPanels * 400 * 8 * 0.85 * 365 * (onPeak / 100) / 1000 : 0;
                const energySavings = demandSavings + arbitrageSavings + solarSavings;
                const taxSavings = energySavings * (tax / 100);
                
                const effMult = smartPanel ? (efficiency / 100) : 0.70;
                const adjEnergy = energySavings * effMult;
                const adjTax = taxSavings * effMult;
                const totalAnnual = adjEnergy + adjTax;
                
                const payback = totalCost / totalAnnual;
                const roi10 = ((totalAnnual * 10 - totalCost) / totalCost) * 100;
                const monthly = totalAnnual / 12;
                const annualized = (Math.pow(1 + (roi10 / 100), 0.1) - 1) * 100;
                
                const effectiveEnergy = actualBatteries * 6.1 * 0.9 * 0.85;
                const acRuntime = effectiveEnergy / unrestrictedPeak;
                const acPlusHouse = effectiveEnergy / (unrestrictedPeak + 1.5);
                const acEnergyShifted = realistic ? (unrestrictedPeak * acHours * acSeason * 30) : 0;
                
                setResults({
                    totalCost, demandSavings, arbitrageSavings, solarSavings, adjEnergy, adjTax, totalAnnual,
                    payback, roi10, monthly, annualized, totalSavings10: totalAnnual * 10,
                    netProfit10: totalAnnual * 10 - totalCost, fedSavings: price * (taxCredit / 100),
                    effMult, actualBatteries, actualCapacity, actualOutput, acRuntime, acPlusHouse,
                    canHandleAC: actualOutput >= unrestrictedPeak, acEnergyShifted, smartCost, solarCost
                });
            };
            
            const fmt = (v) => new Intl.NumberFormat('en-US', {style: 'currency', currency: 'USD', minimumFractionDigits: 0}).format(v || 0);
            const pct = (v) => `${(v || 0).toFixed(1)}%`;

            return (
                <div className="max-w-7xl mx-auto p-4 bg-gradient-to-br from-blue-50 to-green-50 min-h-screen">
                    <div className="text-center mb-6">
                        <h1 className="text-3xl font-bold text-gray-800">🧮 EcoFlow Delta Pro Ultra ROI Calculator</h1>
                        <p className="text-gray-600">Interactive calculator for ROI analysis with APS Phoenix rates</p>
                    </div>

                    <div className="grid lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 space-y-6">
                            
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">⚡ System Configuration</h2>
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Purchase Price ($)</label>
                                        <select value={showCustom ? 'custom' : price} onChange={(e) => {
                                            if (e.target.value === 'custom') setShowCustom(true);
                                            else { setShowCustom(false); setPrice(Number(e.target.value)); }
                                        }} className="w-full px-3 py-2 border rounded-lg">
                                            <option value={4400}>$4,400 (1 battery)</option>
                                            <option value={6699}>$6,699 (2 batteries)</option>
                                            <option value={8999}>$8,999 (3 batteries)</option>
                                            <option value={11299}>$11,299 (4 batteries)</option>
                                            <option value="custom">Custom Price</option>
                                        </select>
                                        {showCustom && <input type="number" placeholder="Enter price" onChange={(e) => setPrice(Number(e.target.value))} className="w-full mt-2 px-3 py-2 border rounded-lg" />}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Tax Credit (%)</label>
                                        <input type="number" value={taxCredit} onChange={(e) => setTaxCredit(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Battery Count</label>
                                        <input type="number" min="1" max="15" value={batteries} onChange={(e) => setBatteries(Number(e.target.value))} disabled={!showCustom} className="w-full px-3 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Capacity (kWh)</label>
                                        <input type="number" step="0.1" value={capacity} onChange={(e) => setCapacity(Number(e.target.value))} disabled={!showCustom} className="w-full px-3 py-2 border rounded-lg" />
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">💰 APS Rates</h2>
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Off-Peak (¢/kWh)</label>
                                        <input type="number" step="0.001" value={offPeak} onChange={(e) => setOffPeak(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">On-Peak (¢/kWh)</label>
                                        <input type="number" step="0.001" value={onPeak} onChange={(e) => setOnPeak(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Demand ($/kW/month)</label>
                                        <input type="number" step="0.1" value={demand} onChange={(e) => setDemand(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Tax Rate (%)</label>
                                        <input type="number" step="0.1" value={tax} onChange={(e) => setTax(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">📅 Usage</h2>
                                <label className="flex items-center gap-2 mb-4">
                                    <input type="checkbox" checked={realistic} onChange={(e) => setRealistic(e.target.checked)} className="w-4 h-4" />
                                    <span className="text-sm font-medium">Realistic Calculation</span>
                                </label>
                                {realistic && (
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Current Peak (kW)</label>
                                            <input type="number" step="0.1" value={currentPeak} onChange={(e) => setCurrentPeak(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Unrestricted Peak (kW)</label>
                                            <input type="number" step="0.1" value={unrestrictedPeak} onChange={(e) => setUnrestrictedPeak(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">AC Season (months)</label>
                                            <input type="number" min="1" max="12" value={acSeason} onChange={(e) => setAcSeason(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">AC Runtime (hours)</label>
                                            <input type="number" step="0.1" min="0" max="3" value={acHours} onChange={(e) => setAcHours(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg" />
                                            <p className="text-xs text-gray-500 mt-1">Hours during 4-7pm period</p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">🏠 Add-ons</h2>
                                <div className="space-y-4">
                                    <div>
                                        <label className="flex items-center gap-2">
                                            <input type="checkbox" checked={smartPanel} onChange={(e) => setSmartPanel(e.target.checked)} className="w-4 h-4" />
                                            <span className="text-sm font-medium">Smart Home Panel ($4,000)</span>
                                        </label>
                                        {smartPanel && (
                                            <div className="mt-2 grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Panel Cost ($)</label>
                                                    <input type="number" value={panelCost} onChange={(e) => setPanelCost(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-1">Efficiency (%)</label>
                                                    <input type="number" min="50" max="100" value={efficiency} onChange={(e) => setEfficiency(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    <div>
                                        <label className="flex items-center gap-2">
                                            <input type="checkbox" checked={solar} onChange={(e) => setSolar(e.target.checked)} className="w-4 h-4" />
                                            <span className="text-sm font-medium">Solar Panels</span>
                                        </label>
                                        {solar && (
                                            <div className="mt-2">
                                                <label className="block text-sm font-medium mb-1">Panel Count</label>
                                                <input type="number" value={solarPanels} onChange={(e) => setSolarPanels(Number(e.target.value))} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="space-y-6">
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">📈 Results</h2>
                                <div className="space-y-4">
                                    <div className="bg-green-50 rounded-lg p-4">
                                        <div className="text-sm text-green-600 font-medium">Payback Period</div>
                                        <div className="text-2xl font-bold text-green-800">{(results.payback || 0).toFixed(1)} years</div>
                                    </div>
                                    <div className="bg-blue-50 rounded-lg p-4">
                                        <div className="text-sm text-blue-600 font-medium">Monthly Savings</div>
                                        <div className="text-2xl font-bold text-blue-800">{fmt(results.monthly)}</div>
                                    </div>
                                    <div className="bg-purple-50 rounded-lg p-4">
                                        <div className="text-sm text-purple-600 font-medium">10-Year ROI</div>
                                        <div className="text-2xl font-bold text-purple-800">{pct(results.roi10)}</div>
                                    </div>
                                    <div className="bg-orange-50 rounded-lg p-4">
                                        <div className="text-sm text-orange-600 font-medium">AC Energy Shifted</div>
                                        <div className="text-lg font-bold text-orange-800">{realistic ? `${(results.acEnergyShifted || 0).toFixed(0)} kWh/year` : 'Generic calc'}</div>
                                        <div className="text-xs text-orange-500">{realistic ? `${acHours}h × ${unrestrictedPeak}kW × ${acSeason * 30} days` : ''}</div>
                                    </div>
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <div className="text-sm text-gray-600 font-medium">System Config</div>
                                        <div className="text-lg font-bold text-gray-800">{results.actualBatteries} Batteries</div>
                                        <div className="text-xs text-gray-500">{(results.actualCapacity || 0).toFixed(1)} kWh, {(results.actualOutput || 0).toFixed(1)} kW</div>
                                    </div>
                                </div>
                            </div>

                            {realistic && results.actualBatteries && (
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-lg font-semibold mb-4">AC Analysis</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">Can Handle 5-ton AC:</span>
                                            <span className={`font-medium ${results.canHandleAC ? 'text-green-600' : 'text-red-600'}`}>
                                                {results.canHandleAC ? 'YES' : 'NO'}
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">AC Runtime:</span>
                                            <span className="font-medium">{(results.acRuntime || 0).toFixed(1)}h</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">AC + House:</span>
                                            <span className="font-medium">{(results.acPlusHouse || 0).toFixed(1)}h</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">Target (1.5h):</span>
                                            <span className={`font-medium ${(results.acPlusHouse || 0) >= 1.5 ? 'text-green-600' : 'text-yellow-600'}`}>
                                                {(results.acPlusHouse || 0) >= 1.5 ? '✅ MEETS' : '⚠️ BELOW'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-lg font-semibold mb-4">Cost Breakdown</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Purchase:</span>
                                        <span className="font-medium">{fmt(price)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Tax Credit:</span>
                                        <span className="font-medium text-green-600">-{fmt(results.fedSavings)}</span>
                                    </div>
                                    {smartPanel && (
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">Smart Panel:</span>
                                            <span className="font-medium">{fmt(results.smartCost)}</span>
                                        </div>
                                    )}
                                    {solar && (
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">Solar:</span>
                                            <span className="font-medium">{fmt(results.solarCost)}</span>
                                        </div>
                                    )}
                                    <div className="border-t pt-2 flex justify-between font-semibold">
                                        <span>Net Investment:</span>
                                        <span>{fmt(results.totalCost)}</span>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-lg font-semibold mb-4">Annual Savings</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Demand:</span>
                                        <span className="font-medium">{fmt(results.demandSavings)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Arbitrage:</span>
                                        <span className="font-medium">{fmt(results.arbitrageSavings)}</span>
                                    </div>
                                    {solar && (
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">Solar:</span>
                                            <span className="font-medium">{fmt(results.solarSavings)}</span>
                                        </div>
                                    )}
                                    <div className="flex justify-between text-sm">
                                        <span className="text-gray-500">Efficiency ({((results.effMult || 0) * 100).toFixed(0)}%):</span>
                                        <span className="text-gray-500">{fmt(results.adjEnergy)}</span>
                                    </div>
                                    <div className="border-t pt-2 flex justify-between font-semibold">
                                        <span>Total:</span>
                                        <span>{fmt(results.totalAnnual)}</span>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-lg font-semibold mb-4">10-Year Projection</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Total Savings:</span>
                                        <span className="font-medium">{fmt(results.totalSavings10)}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">System Cost:</span>
                                        <span className="font-medium">-{fmt(results.totalCost)}</span>
                                    </div>
                                    <div className="border-t pt-2 flex justify-between font-semibold text-green-600">
                                        <span>Net Profit:</span>
                                        <span>{fmt(results.netProfit10)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="mt-8 bg-white rounded-xl shadow-lg p-6">
                        <h3 className="text-lg font-semibold mb-3">Notes</h3>
                        <div className="text-sm text-gray-600 space-y-1">
                            <p>• 30% tax credit expires Dec 31, 2025</p>
                            <p>• Realistic mode uses actual vs unrestricted usage</p>
                            <p>• Pricing: $4,400 (1), $6,699 (2), $8,999 (3), $11,299 (4 batteries)</p>
                            <p>• AC analysis assumes 5-ton unit (10.3 kW)</p>
                            <p>• Smart Panel enables 95% efficiency vs 70% manual</p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<Calculator />, document.getElementById('root'));
    </script>
</body>
</html>
